#include "../../../stdc.h"

using namespace std;


//ç»™ä½ ä¸€ä¸ªå­—ç¬¦ä¸²è¡¨è¾¾å¼ s ï¼Œè¯·ä½ å®ç°ä¸€ä¸ªåŸºæœ¬è®¡ç®—å™¨æ¥è®¡ç®—å¹¶è¿”å›å®ƒçš„å€¼ã€‚ 
//
// æ•´æ•°é™¤æ³•ä»…ä¿ç•™æ•´æ•°éƒ¨åˆ†ã€‚ 
//
// ä½ å¯ä»¥å‡è®¾ç»™å®šçš„è¡¨è¾¾å¼æ€»æ˜¯æœ‰æ•ˆçš„ã€‚æ‰€æœ‰ä¸­é—´ç»“æœå°†åœ¨ [-2Â³Â¹, 2Â³Â¹ - 1] çš„èŒƒå›´å†…ã€‚ 
//
// æ³¨æ„ï¼šä¸å…è®¸ä½¿ç”¨ä»»ä½•å°†å­—ç¬¦ä¸²ä½œä¸ºæ•°å­¦è¡¨è¾¾å¼è®¡ç®—çš„å†…ç½®å‡½æ•°ï¼Œæ¯”å¦‚ eval() ã€‚ 
//
// 
//
// ç¤ºä¾‹ 1ï¼š 
//
// 
//è¾“å…¥ï¼šs = "3+2*2"
//è¾“å‡ºï¼š7
// 
//
// ç¤ºä¾‹ 2ï¼š 
//
// 
//è¾“å…¥ï¼šs = " 3/2 "
//è¾“å‡ºï¼š1
// 
//
// ç¤ºä¾‹ 3ï¼š 
//
// 
//è¾“å…¥ï¼šs = " 3+5 / 2 "
//è¾“å‡ºï¼š5
// 
//
// 
//
// æç¤ºï¼š 
//
// 
// 1 <= s.length <= 3 * 10âµ 
// s ç”±æ•´æ•°å’Œç®—ç¬¦ ('+', '-', '*', '/') ç»„æˆï¼Œä¸­é—´ç”±ä¸€äº›ç©ºæ ¼éš”å¼€ 
// s è¡¨ç¤ºä¸€ä¸ª æœ‰æ•ˆè¡¨è¾¾å¼ 
// è¡¨è¾¾å¼ä¸­çš„æ‰€æœ‰æ•´æ•°éƒ½æ˜¯éè´Ÿæ•´æ•°ï¼Œä¸”åœ¨èŒƒå›´ [0, 2Â³Â¹ - 1] å†… 
// é¢˜ç›®æ•°æ®ä¿è¯ç­”æ¡ˆæ˜¯ä¸€ä¸ª 32-bit æ•´æ•° 
// 
//
// Related Topics æ ˆ æ•°å­¦ å­—ç¬¦ä¸² ğŸ‘ 821 ğŸ‘ 0


namespace solution227{
    //leetcode submit region begin(Prohibit modification and deletion)
class Solution {
public:
    // è‡ªå·±å®ç°åŒæ ˆè§£å†³æ–¹æ³•æ¯”è¾ƒå¤æ‚, å…ˆæ›´æ¢æˆå•æ ˆçš„å¤„ç†é€»è¾‘è¿›è¡Œå®ç°(åé¢çš„è¿™ç§æ€è·¯éå¸¸ç®€å• å¾ˆæ¸…æ™°ï¼ï¼)
        // æ³¨æ„å¯èƒ½å‡ºç°çš„è´Ÿå· å³å¼€å¤´æ”¾ä¸€ä¸ª'0'
        // å…¶å®æˆ‘è‡ªå·±å®ç°çš„é€»è¾‘ä¸è¿™ç§æ–¹æ³•ç±»ä¼¼ï¼Œåªä¸è¿‡åœ¨å¤„ç†stringä¸Šé¢çš„æ•°æ®ä¸Šè¦æ¬ ç¼ºä¸€äº›
        // è¡¥å……: å¦‚ä½•å‡ºç°ç©ºæ ¼ä»¥åŠæ‹¬å·é—®é¢˜åº”è¯¥å¦‚ä½•æ“ä½œ(æœ‰ä¸€ä¸ªå¾ˆå¥½çš„è§£å†³æ€è·¯æ˜¯ç›´æ¥ä½¿ç”¨é€’å½’æ¥è§£å†³æ‹¬å·) ç©ºæ ¼æ˜¯å¯ä»¥ç›´æ¥è·³è¿‡çš„

    stack<int> num;  //å­˜è´®æ•°å­—
    stack<char> op;  //å­˜è´®æ“ä½œ

    // å½“å‰å‡½æ•°ä¸ºè¯»å–
    void eval()
    {
        // é¿å…å…ƒç´ æ•°é‡ä¸å¤Ÿçš„æ—¶å€™æ‰§è¡Œæ“ä½œ
        if(num.size() < 2) return ;

        int a = num.top();
        num.pop();
        int b = num.top();
        num.pop();
        auto tmp = op.top();
        op.pop();
        switch (tmp) {
            case '+':
            {
                num.push(b + a);
                break;
            }
            case '-':
            {
                num.push(b - a);
                break;
            }
            case '*':
            {
                num.push(b * a);
                break;
            }
            case '/':
            {
                num.push(b / a);
                break;
            }
            default:
            {
                cout << "Warning !!!" << endl;
            }
        }
    }


    int calculate(string s)
    {
        // å®šä¹‰è¿ç®—ç¬¦çš„ä¼˜å…ˆçº§
        unordered_map<char, int> mp;
        mp['+'] = 0;
        mp['-'] = 0;
        mp['*'] = 1;
        mp['/'] = 1;

        // æ»¤é™¤å­—ç¬¦ä¸²ä¸­å¤šä½™çš„ç©ºæ ¼
        int slow = 0;
        int fast = 0;
        while(fast < s.size())
        {
            if(s[fast] != ' ')
                s[slow++] = s[fast];
            ++fast;
        }
        s = s.substr(0, slow);

        for(int i = 0; i < s.size(); ++i)
        {
            int count = 0;
            while(i < s.size() && s[i] >= '0' && s[i] <= '9')
            {
                count = count * 10 + (s[i] - '0');
                ++i;
            }
            // å½“å‰å­—ç¬¦ä¸ºè¿ç®—ç¬¦å¹¶ä¸”numä¸­ä¿å­˜äº†ä¸€ä¸ªæ•°å­—
            num.push(count);

            if(i != s.size())
            {
                // note æ³¨æ„è¿™é‡Œå¯¹åº”çš„æ“ä½œ, åªæœ‰å½“å‰æ ˆä¸­å¯¹åº”çš„æ“ä½œä¼˜å…ˆçº§æ›´é«˜æ‰éœ€è¦æå‰å¤„ç†, æ— è®ºå¤„ç†ä¸å¦å½“å‰çš„è¿™ç§æ“ä½œæ•°ä¹Ÿéœ€è¦æ”¾å…¥æ ˆä¸­
                // å¹¶ä¸”è¿™é‡Œçš„ä¼˜å…ˆçº§å¦‚æœç›¸åŒ, ä¹Ÿå¾—å…ˆå»å¤„ç†å‰é¢ ï¼ï¼ æ¯”å¦‚ 1-2-56 å¦‚æœå…ˆå¤„ç†åé¢çš„å‡å·å°±ä¼šå˜æˆ 1 - (-54) æœ€åç»“æœå°±ä¼šå˜ä¸º53 | å¹¶ä¸”è¿™é‡Œä¸€å®šæ˜¯è¦å†™æˆwhileå°±ç±»ä¼¼ä¸å•è°ƒé˜Ÿåˆ—,è¦æ±‚å‰é¢èƒ½å‰ä¸€æ­¥å¤„ç†çš„è®¡ç®—éƒ½å…ˆè¿›è¡Œå¤„ç†
                // ä¸€å®šæ˜¯ while(!op.empty() && mp[op.top()] >= mp[s[i]]) è€Œä¸æ˜¯ if(!op.empty() && mp[op.top()] >= mp[s[i]])
                while(!op.empty() && mp[op.top()] >= mp[s[i]])
                    eval();
                op.push(s[i]);
            }
        }

        // æ‰€æœ‰æ•°å­—è¢«è¯»å–å®Œæ¯•
        while(!op.empty())
            eval();

        cout << num.top() << endl;
        return num.top();

    }

//    // è¿ç®—ç¬¦çš„ä¼˜å…ˆçº§æ¯”è¾ƒ
//    unordered_map<char, int> m_map;
//    // ç”±äºå…¶ä¿ç•™äº†åŠ å‡ä¹˜é™¤ï¼Œä¸ç”¨è€ƒè™‘ç©ºæ ¼æ¥è¿›è¡Œå¤„ç†
//    int calculate(string s)
//    {
//        m_map['+'] = 0;
//        m_map['-'] = 0;
//        m_map['*'] = 1;
//        m_map['/'] = 1;
//        stack<int> s1;
//        stack<char> s2;
//        // å¯¹å­—ç¬¦ä¸²æ¸…ç†ç©ºæ ¼
//        int slow = 0;
//        int fast = 0;
//        while(fast < s.size())
//        {
//            if(s[fast] != ' ')
//                s[slow++] = s[fast];
//            ++fast;
//        }
//        s = s.substr(0, slow);
//
//        // åŒæ ˆè·å–æ•°æ®
//        int i = 0;
//        int last = 0;
//        while(i < s.size())
//        {
//
//            if(s[i] < '0' || s[i] > '9' || s.size() - i == 1)
//            {
//                // è·å–æ•°å­—ä»¥åŠè·å–å½“å‰çš„æ“ä½œæ•°
//                auto tmp = s.substr(last, i - last);
//                s1.push(stoi(tmp));
//                // åˆ¤æ–­å½“å‰çš„æ“ä½œæ•°æ˜¯å¦ä¸ºç©º
//                if(s2.empty()) s2.push(s[i]);
//                else
//                {
//                    if(m_map[s[i]] < m_map[s2.top()] && m_map[s2.top()] == 1)
//                    {
//                        auto a = s1.top();
//                        s1.pop();
//                        auto b = s1.top();
//                        s1.pop();
//
//                        if(s[i] == '*') s1.push(a*b);
//                        else
//                            s1.push(a/b);
//                    }
//                    // ä¿è¯æ˜¯ç¬¦å·æ‰èƒ½è¢«s2è¯»å–
//                    if(s[i] < '0' || s[i] > '9') s2.push(s[i]);
//                }
//                last = i+1;
//            }
//            ++i;
//        }
//
//        // æœ€ç»ˆéƒ½æ˜¯+-å…ƒç´ ä¹‹é—´çš„æ¯”è¾ƒ
//        while(!s1.empty() && !s2.empty())
//        {
//            auto a = s2.top();
//            s2.pop();
//            auto b = s1.top();
//            s1.pop();
//            auto c = s1.top();
//            s1.pop();
//
//            if(a == '+')
//                s1.push(a + b);
//            else if(a == '-')
//                s1.push(a - b);
//        }
//
//        return s1.top();
//    }
};
//leetcode submit region end(Prohibit modification and deletion)

}

using namespace solution227;
int main() {
    Solution solution = Solution();
    solution.calculate("1*2-3/4+5*6-7*8+9/10");


    return 0;
}
